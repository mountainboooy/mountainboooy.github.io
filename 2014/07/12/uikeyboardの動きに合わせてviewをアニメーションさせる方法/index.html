<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><title>UIKeyboardの動きに合わせてviewをアニメーションさせる方法</title><!-- javascript--><script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><script src="/js/main.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css"><!-- Google Analytics--><!-- Global site tag (gtag.js)--><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-41355170-3"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-41355170-3');
</script><!-- Open graph      --><meta name="description" content="UIkeyboardの動きに合わせてビューも移動させたい。以下の動画ではピンクの部分が対象のビュー。">
<meta name="keywords" content="iOS,iPhone,iOS7,UIKeyboard,UIViewAnimationCurve,UIViewAnimationOptions">
<meta property="og:type" content="article">
<meta property="og:title" content="UIKeyboardの動きに合わせてviewをアニメーションさせる方法">
<meta property="og:url" content="https://github.com/mountainboooy.github.io/2014/07/12/uikeyboardの動きに合わせてviewをアニメーションさせる方法/index.html">
<meta property="og:site_name" content="mountainboooy">
<meta property="og:description" content="UIkeyboardの動きに合わせてビューも移動させたい。以下の動画ではピンクの部分が対象のビュー。">
<meta property="og:locale" content="ja">
<meta property="og:image" content="http://mountainboy.boo.jp/wordpress/wp-content/uploads/2014/07/keyboard.gif">
<meta property="og:updated_time" content="2018-10-28T04:11:41.252Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="UIKeyboardの動きに合わせてviewをアニメーションさせる方法">
<meta name="twitter:description" content="UIkeyboardの動きに合わせてビューも移動させたい。以下の動画ではピンクの部分が対象のビュー。">
<meta name="twitter:image" content="http://mountainboy.boo.jp/wordpress/wp-content/uploads/2014/07/keyboard.gif"><!--css--><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700,700i|Righteous|Roboto:400,400i,500,500i,700,700i"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="content"><div class="content-nav"><div class="sidenav"><div class="sidenav__header">m</div><ul class="unstyled-list sidenav__menu"><li class="sidenav__menu__item"><a class="unstyled-link" href="/">BLOG</a><div class="sidenav__menu__item__marker"></div></li><li class="sidenav__menu__item"><a class="unstyled-link" href="/about">PROFILE</a><div class="sidenav__menu__item__marker"></div></li><li class="sidenav__menu__item"><a class="unstyled-link" href="/works">WORKS</a><div class="sidenav__menu__item__marker"></div></li></ul><div class="sidenav__divider"></div><div class="profile"><div class="profile-thumb"><img src="https://i.gyazo.com/13a3f490a5a42074ffdb1722d8a38c3d.jpg"/></div><div class="profile-name"><h3 class="align-center">TAKEU YOSHIHARA</h3></div><div class="profile-desc">ゴーシュは町の活動写真館でセロを弾く係りでした。けれどもあんまり上手でないという評判でした。ゴーシュは町の活動写真館でセロを弾く係りでした。上手でないどころではなく実は仲間のゴーシュは町の活動写真館でセロを弾く係りでした。上手でないどころではなく実は仲間の…</div></div></div></div><div class="content-main"> <div class="post"><div class="container"><!-- date--><div class="created">2014.7.12</div><!--title--><h1 class="post-title">UIKeyboardの動きに合わせてviewをアニメーションさせる方法</h1><!-- tags--><div class="post-tags"><a class="btn btn-tag post-tag" href="/tags/iOS/">iOS</a><a class="btn btn-tag post-tag" href="/tags/iPhone/">iPhone</a><a class="btn btn-tag post-tag" href="/tags/iOS7/">iOS7</a><a class="btn btn-tag post-tag" href="/tags/UIKeyboard/">UIKeyboard</a><a class="btn btn-tag post-tag" href="/tags/UIViewAnimationCurve/">UIViewAnimationCurve</a><a class="btn btn-tag post-tag" href="/tags/UIViewAnimationOptions/">UIViewAnimationOptions</a></div><!-- article--><div class="article"><p>UIkeyboardの動きに合わせてビューも移動させたい。以下の動画ではピンクの部分が対象のビュー。<a id="more"></a></p>
<p><a href="http://mountainboy.boo.jp/wordpress/wp-content/uploads/2014/07/keyboard.gif" target="_blank" rel="noopener"><img src="http://mountainboy.boo.jp/wordpress/wp-content/uploads/2014/07/keyboard.gif" alt="keyboard"></a></p>
<p><span style="font-size: 12pt;"><strong>通常の方法</strong></span><br>NSNotificationCenterを使い、キーボードの動きを通知。その際にキーボードの動きに合わせてビューのアニメーションを行う。キーボードのアニメーションに関するパラメータはNSNotificationCenterの引数として渡されるので、それを使用する。</p>
<p><span style="font-size: 12pt;"><strong>問題点</strong></span><br>NSNotificationの引数として渡されるUIKeyboardのアニメーションの動きはUIViewAnimationCurve型。しかし、UIViewのアニメーションを定義するのに必要なパラメータはUIViewAnimationOptions型。なのでUIViewAnimationCurveをUIViewAnimationOptionsに変換してあげる必要がある。UIViewAnimationOptionsはドキュメントでは4つ定義してあり、通常であればこの4つのいずれかに当てはまるはず。ところが、UIKeyboardに使われてるUIViewAnimationCurveは上記のいずれのオプションにも当てはまらない。iO7以降では、KIKeyboardのアニメーションはドキュメント非記述の設定で動いているようだ。</p>
<p><span style="font-size: 12pt;"><strong>解決案</strong></span><br>UIViewAnimationCurveの値を強引にUIViewAnimationOptionsに変換する。どうやらUIViewAnimationCurveをビット演算で左に16回シフトするとUIViewAnimationOptionsの値になるようだ。</p>
<blockquote>
<p><pre class="brush: objc; gutter: false">- (void)keyboardWillMove:(NSNotification *)n</pre></p>
<p>{</p>
<pre><code>CGRect keyboardFrame = [n.userInfo[UIKeyboardFrameEndUserInfoKey]CGRectValue];


//animation params

NSTimeInterval duration = [n.userInfo[UIKeyboardAnimationDurationUserInfoKey] doubleValue];

UIViewAnimationCurve keyboardCurve = [n.userInfo[UIKeyboardAnimationCurveUserInfoKey]intValue];

UIViewAnimationOptions keyboardOption = keyboardCurve &amp;lt;&amp;lt; 16;


_bottmSpaceToInputView.constant = self.view.frame.size.height - keyboardFrame.origin.y;


//animation action

[UIView animateWithDuration:duration delay:0.0 options:keyboardOption animations:^{

    [self.view layoutIfNeeded];

} completion:nil];
</code></pre><p>}</p>
<p><br><span style="font-size: 12pt;"><strong>参考URL</strong></span><br><a href="https://devforums.apple.com/message/878410#878410" target="_blank" rel="noopener">https://devforums.apple.com/message/878410#878410</a></p>
</blockquote>
</div></div></div></div></div></body></html>