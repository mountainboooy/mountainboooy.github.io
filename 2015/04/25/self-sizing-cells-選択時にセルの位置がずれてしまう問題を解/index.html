<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/><title>Self Sizing Cells 選択時にセルの位置がずれてしまう問題を解決</title><!-- javascript--><script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><script src="/js/main.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.css"><!-- Google Analytics--><!-- Global site tag (gtag.js)--><script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-41355170-3"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-41355170-3');
</script><!-- Open graph      --><meta name="description" content="問題iOS8からはtableViewのセルの高さを動的に計算できるようになった。使ってみるとひとつ問題が発生。セルを選択して次画面にナビゲーション遷移する場合、選択直後にセルの位置がずれてしまう。 ####  原因セル選択時にestimatedHeightForRowIndexPathが呼ばれて、セルの高さが一斉にデフォルト値に調整されているっぽい。なぜかは分からない。 ####  解決策セルの表">
<meta name="keywords" content="iOS,iOS8,swift,UITableView">
<meta property="og:type" content="article">
<meta property="og:title" content="Self Sizing Cells 選択時にセルの位置がずれてしまう問題を解決">
<meta property="og:url" content="https://github.com/mountainboooy.github.io/2015/04/25/self-sizing-cells-選択時にセルの位置がずれてしまう問題を解/index.html">
<meta property="og:site_name" content="mountainboooy">
<meta property="og:description" content="問題iOS8からはtableViewのセルの高さを動的に計算できるようになった。使ってみるとひとつ問題が発生。セルを選択して次画面にナビゲーション遷移する場合、選択直後にセルの位置がずれてしまう。 ####  原因セル選択時にestimatedHeightForRowIndexPathが呼ばれて、セルの高さが一斉にデフォルト値に調整されているっぽい。なぜかは分からない。 ####  解決策セルの表">
<meta property="og:locale" content="ja">
<meta property="og:updated_time" content="2018-04-03T10:47:18.954Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Self Sizing Cells 選択時にセルの位置がずれてしまう問題を解決">
<meta name="twitter:description" content="問題iOS8からはtableViewのセルの高さを動的に計算できるようになった。使ってみるとひとつ問題が発生。セルを選択して次画面にナビゲーション遷移する場合、選択直後にセルの位置がずれてしまう。 ####  原因セル選択時にestimatedHeightForRowIndexPathが呼ばれて、セルの高さが一斉にデフォルト値に調整されているっぽい。なぜかは分からない。 ####  解決策セルの表"><!--css--><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i|Open+Sans:300,300i,400,400i,600,600i,700,700i|Roboto:300,400,500,700,900"><link rel="stylesheet" href="/css/prism-xonokai.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div class="sidemenu"><div class="backdrop"></div><ul class="unstyled-list sidemenu-list"><li><a class="unstyled-link" href="/">Home </a></li><li><a class="unstyled-link" href="/about">About</a></li></ul></div><script>$(function () {
  $('.logo').click(toggleMenu)    
  $('.sidemenu').click(toggleMenu)
})

function toggleMenu () {
  if (isShown()) {
    closeMenu()
  } else {
    openMenu()
  }
}

function isShown () {
  return $('.sidemenu').css('display') === 'block'
}

function openMenu () {
  $('.sidemenu').show()
  setTimeout(function () {
    $('.backdrop').addClass('open')
    $('.sidemenu-list').addClass('open')
  }, 100)
}

function closeMenu () {
  $('.sidemenu-list').removeClass('open')
  $('.backdrop').removeClass('open')
  setTimeout(function () {
    $('.sidemenu').hide()
  }, 300)
}</script><header><div class="container"> <a class="logo"><strong class="logo-text">M</strong></a></div></header><div class="body"> <div class="post"><div class="container"><!-- date--><div class="created">2015.4.25</div><!--title--><h1 class="post-title">Self Sizing Cells 選択時にセルの位置がずれてしまう問題を解決</h1><!-- tags--><div class="post-tags"><a class="btn btn-tag post-tag" href="/tags/iOS/">iOS</a><a class="btn btn-tag post-tag" href="/tags/iOS8/">iOS8</a><a class="btn btn-tag post-tag" href="/tags/swift/">swift</a><a class="btn btn-tag post-tag" href="/tags/UITableView/">UITableView</a></div><!-- article--><div class="article"><h4 id="問題"><a href="#問題" class="headerlink" title="問題"></a>問題</h4><p>iOS8からはtableViewのセルの高さを動的に計算できるようになった。使ってみるとひとつ問題が発生。セルを選択して次画面にナビゲーション遷移する場合、選択直後にセルの位置がずれてしまう。</p>
<p>#### </p>
<h4 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h4><p>セル選択時にestimatedHeightForRowIndexPathが呼ばれて、セルの高さが一斉にデフォルト値に調整されているっぽい。なぜかは分からない。</p>
<p>#### </p>
<h4 id="解決策"><a href="#解決策" class="headerlink" title="解決策"></a>解決策</h4><p>セルの表示タイミングで実際のセルサイズをキャッシュして、estimatedHeightForRowIndexPathでその値を返すようにすることで対処できた。</p>
<pre class="theme:github toolbar:2 show-lang:2 lang:swift decode:true ">func tableView(tableView: UITableView, willDisplayCell cell: UITableViewCell, forRowAtIndexPath indexPath: NSIndexPath) {
    // セルが表示されるタイミングで高さをキャッシュ
    self.cache?[indexPath.row] = cell.frame.size.height
}

func tableView(tableView: UITableView, estimatedHeightForRowAtIndexPath indexPath: NSIndexPath) -&amp;amp;gt; CGFloat {
    if let height = self.cache?[indexPath.row] {
   return height
    }
    return defaultHeight
}</pre></div></div></div></div><div class="profile"><div class="container"><div class="profile-header"><div class="profile-header-name">TAKERU<br/>YOSHIHARA</div><div class="profile-header-avator"> <img src="https://i.gyazo.com/13a3f490a5a42074ffdb1722d8a38c3d.jpg"/></div></div><div class="profile-body">ゴーシュは町の活動写真館でセロを弾く係りでした。けれどもあんまり上手でないという評判でした。ゴーシュは町の活動写真館でセロを弾く係りでした。上手でないどころではなく実は仲間のゴーシュは町の活動写真館でセロを弾く係りでした。上手でないどころではなく実は仲間の…</div><div class="profile-footer"><div class="profile-social profile-social-twitter"></div><div class="profile-social profile-social-facebook"></div><div class="profile-social profile-socila-github"></div></div></div></div><footer>© 2018 Takeru Yoshihara </footer></body></html>